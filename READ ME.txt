This is almost complete. It misses the CSRF security.